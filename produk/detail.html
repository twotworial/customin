<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Detail Produk | Customin.co</title>
  <meta name="description" content="Detail produk Customin.co">
  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/produk/produk.css">
  <link rel="stylesheet" href="/assets/cart.css">
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>
</head>
<body>
  <div class="main-wrapper">
    <div class="product-detail-modern">
      <div class="pd-header">
        <div class="pd-bar">
          <a href="/produk/" class="pd-icon-btn" aria-label="Kembali ke Produk" title="Kembali ke Produk">
            <span class="iconify" data-icon="mdi:arrow-left"></span>
          </a>
          <nav class="pd-crumbs" aria-label="Breadcrumb">
            <ol>
              <li><a href="/">Home</a></li>
              <li class="sep" aria-hidden="true">›</li>
              <li><a href="/produk/">Produk</a></li>
              <li class="sep" aria-hidden="true">›</li>
              <li class="current" aria-current="page" id="crumbName">Produk</li>
            </ol>
          </nav>
          <button class="pd-icon-btn" aria-label="Bagikan" title="Bagikan" id="shareBtn">
            <span class="iconify" data-icon="mdi:share-outline"></span>
          </button>
        </div>
      </div>

      <!-- GALERI -->
      <div class="pd-imgbox">
        <img id="mainProductImg" src="" alt="">
      </div>
      <div class="pd-gallery-thumbs" id="thumbs"></div>

      <!-- INFO -->
      <div class="pd-info">
        <div class="pd-info-main">
          <div>
            <div class="pd-title" id="pdTitle">Produk</div>
            <a class="pd-chip pd-cat" href="#" id="catLink"><span class="iconify" data-icon="mdi:seat-outline"></span> <span id="catName">Kategori</span></a>
          </div>
          <div class="pd-price" id="pdPrice">Rp 0</div>
        </div>
        <div class="pd-rating" id="pdRating" hidden>
          <span class="iconify" data-icon="mdi:star" style="color:#FFD700"></span>
          <span id="pdRatingVal">0</span> <span class="pd-rating-count" id="pdReviews"></span>
        </div>
      </div>

      <!-- TABS -->
      <div class="pd-tabs" role="tablist">
        <button class="pd-tab active" role="tab">Deskripsi</button>
        <button class="pd-tab" role="tab">Detail</button>
        <button class="pd-tab" role="tab">Pemesanan</button>
      </div>
      <div class="pd-tab-content">
        <div class="pd-tab-panel active" id="tabDesc"></div>
        <div class="pd-tab-panel"><ul class="pd-detail-list" id="detailList"></ul></div>
        <div class="pd-tab-panel">
          <ol>
            <li>Pilih jumlah.</li>
            <li>Tekan <b>Order</b> untuk masuk keranjang.</li>
            <li>Checkout via WhatsApp di keranjang.</li>
          </ol>
        </div>
      </div>

      <!-- BOTTOM BAR -->
      <div class="pd-bottombar">
        <a href="/" class="mini-nav-btn" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
        <div class="pd-qtybox">
          <button class="qty-btn" type="button" aria-label="Kurangi">-</button>
          <span class="qty-value" id="qtyVal">1</span>
          <button class="qty-btn" type="button" aria-label="Tambah">+</button>
        </div>
        <button class="pd-addcart-btn" type="button">Order</button>
        <button class="mini-nav-btn js-cart-btn" title="Keranjang" aria-label="Keranjang">
          <span class="iconify" data-icon="mdi:cart-outline"></span>
          <span class="cart-badge" data-cart-count>0</span>
        </button>
      </div>
    </div>
  </div>

  <script src="/assets/cart.js"></script>
  <script>
    const rp = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug');

    (async function(){
      if(!slug){ document.getElementById('pdTitle').textContent='Produk tidak ditemukan'; return; }
      let items=[];
      try{
        const res=await fetch('/data/products.json',{cache:'no-store'});
        items=await res.json();
      }catch(e){ console.error(e); }

      const p = items.find(x=>x.slug===slug);
      if(!p){ document.getElementById('pdTitle').textContent='Produk tidak ditemukan'; return; }

      // Isi basic
      document.title = p.title + ' | Customin.co';
      document.getElementById('pdTitle').textContent = p.title;
      document.getElementById('crumbName').textContent = p.title;
      document.getElementById('pdPrice').textContent = rp(p.price);
      document.getElementById('mainProductImg').src = (p.images&&p.images[0]) || p.cover;
      document.getElementById('mainProductImg').alt = p.title;

      // Kategori
      document.getElementById('catName').textContent = p.category;
      const catLink = document.getElementById('catLink');
      catLink.href = '/produk/?kategori=' + encodeURIComponent(p.category);

      // Rating (opsional)
      if(p.rating){
        document.getElementById('pdRating').hidden = false;
        document.getElementById('pdRatingVal').textContent = p.rating;
        document.getElementById('pdReviews').textContent = `(${p.reviewsCount||0} reviews)`;
      }

      // Deskripsi (HTML kecil aman)
      document.getElementById('tabDesc').innerHTML = p.description || (p.excerpt||'');

      // Detail list
      const dl = document.getElementById('detailList');
      Object.entries(p.details||{}).forEach(([k,v])=>{
        const li=document.createElement('li');
        li.innerHTML = `<b>${k}:</b> ${v}`;
        dl.appendChild(li);
      });

      // Thumbs
      const thumbs = document.getElementById('thumbs');
      (p.images||[p.cover]).forEach((src,i)=>{
        const btn=document.createElement('button');
        btn.className='thumb'+(i===0?' active':'');
        btn.innerHTML=`<img src="${src}" alt="${p.title} foto ${i+1}">`;
        btn.addEventListener('click',()=>{
          document.getElementById('mainProductImg').src = src;
          [...thumbs.children].forEach(t=>t.classList.remove('active'));
          btn.classList.add('active');
        });
        thumbs.appendChild(btn);
      });

      // Qty
      document.querySelectorAll('.qty-btn').forEach(btn=>{
        btn.onclick = ()=> {
          const vEl = document.getElementById('qtyVal');
          let v = parseInt(vEl.textContent,10) || 1;
          if(btn.textContent==='-' && v>1) v--;
          if(btn.textContent==='+') v++;
          vEl.textContent = v;
        };
      });

      // Share
      document.getElementById('shareBtn').onclick = async ()=>{
        try{
          if(navigator.share){ await navigator.share({title:document.title,url:location.href}); }
          else{ await navigator.clipboard.writeText(location.href); alert('Tautan disalin!'); }
        }catch(_){}
      };

      // Expose ke cart.js (kalau butuh)
      window.__currentProduct = { id:p.id, slug:p.slug, title:p.title, price:p.price, image: (p.images&&p.images[0])||p.cover };
    })();
  </script>
</body>
</html>
