<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Katalog Produk | Customin.co</title>
  <meta name="description" content="Katalog produk furniture custom: kursi, meja, lemari, rak, dan lainnya." />
  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>

  <!-- Base styles (pakai punyamu jika sudah ada) -->
  <link rel="stylesheet" href="/katalog.css" />
  <link rel="stylesheet" href="/assets/cart.css" />

  <!-- Override kecil untuk rasio foto 1:1 + layout harga & tombol -->
  <style>
    /* foto 1:1 */
    .product-img{ position:relative; display:block; width:100%; aspect-ratio:1/1; background:#f7f7f7; overflow:hidden; }
    .product-img img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; }

    /* konten kartu */
    .product-content{ padding:12px; display:flex; flex-direction:column; gap:8px; }
    .product-title{ margin:0; font-size:14px; font-weight:800; line-height:1.35; }

    /* harga jadi chip sendiri (ganti area rating) */
    .price-chip{
      display:inline-flex; align-items:center;
      padding:6px 10px; border-radius:10px;
      font-weight:800; font-size:14px; color:var(--accent);
      background:#fff; border:1px solid #f3e2d8;
      box-shadow:0 2px 6px rgba(0,0,0,.04); width:max-content;
    }

    /* footer khusus tombol saja */
    .product-footer{ display:flex; justify-content:flex-end; }
    .order-btn{
      display:inline-flex; align-items:center; justify-content:center;
      height:34px; padding:0 12px; border:1px solid #ddd; border-radius:12px;
      background:#fff; font-size:12px; font-weight:700; text-decoration:none;
      box-shadow:0 2px 4px rgba(0,0,0,.05); cursor:pointer; white-space:nowrap;
    }
    .order-btn:active{ transform:translateY(1px); }

    /* badge */
    .badge{
      position:absolute; left:10px; top:10px; font-size:11px; font-weight:800;
      background:#111; color:#fff; padding:4px 8px; border-radius:999px;
    }
    .badge-sale{ background:var(--accent); }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <div class="bio-card">

      <header class="page-head">
        <nav class="crumbs" aria-label="Breadcrumb">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="sep" aria-hidden="true">›</li>
            <li aria-current="page" id="crumbCurrent">Produk</li>
          </ol>
        </nav>
        <h1 class="page-title">Katalog Produk</h1>
      </header>

      <main class="card-content" id="main">
        <!-- Filter -->
        <section class="filters">
          <div class="search-wrap">
            <span class="iconify" data-icon="mdi:magnify"></span>
            <input id="q" type="search" placeholder="Cari produk… (mis. kursi, meja)" autocomplete="off">
          </div>

          <div class="selects">
            <label class="select" for="catSelect">
              <span class="select-label">Kategori</span>
              <select id="catSelect">
                <!-- akan diisi dinamis -->
              </select>
            </label>

            <label class="select" for="tagSelect">
              <span class="select-label">Tag</span>
              <select id="tagSelect" multiple>
                <!-- akan diisi dinamis -->
              </select>
            </label>
          </div>

          <p class="hint">Tip: tahan <b>Ctrl/Cmd</b> untuk pilih banyak tag.</p>
        </section>

        <!-- Grid -->
        <section class="produk-grid" id="grid" aria-live="polite"></section>
      </main>

      <!-- NAV (Home | Menu | Cart) -->
      <nav class="in-card-nav" aria-label="Navigasi utama">
        <div class="nav-content">
          <a href="/" class="nav-item" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
          <button type="button" class="menu-button" id="menuButton" aria-controls="popupMenu" aria-expanded="false" aria-label="Menu"><span class="iconify" data-icon="mdi:view-grid-outline"></span></button>
          <a href="/keranjang" class="nav-item js-cart-btn" title="Keranjang" aria-label="Keranjang">
            <span class="iconify" data-icon="mdi:cart-outline"></span>
            <span class="cart-badge" data-cart-count>0</span>
          </a>
        </div>
      </nav>

    </div>
  </div>

  <!-- Popup menu -->
  <div class="popup-menu" id="popupMenu"></div>

  <!-- Cart core -->
  <script src="/assets/cart.js" defer></script>

  <script>
  // ====== Helper ======
  const fmtIDR = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);

  function cardHTML(p){
    const badge = p.badge ? `<span class="badge ${p.badge==='Promo'?'badge-sale':''}">${p.badge}</span>` : '';
    return `
    <article class="product-card" data-kategori="${p.category}" data-tags="${(p.tags||[]).join(',')}">
      <a class="product-img" href="/produk/${p.slug}.html" aria-label="${p.title}">
        <img src="${p.cover}" alt="${p.title}">
        ${badge}
      </a>
      <div class="product-content">
        <h2 class="product-title"><a href="/produk/${p.slug}.html" style="color:inherit;text-decoration:none">${p.title}</a></h2>

        <!-- harga tampil sebagai chip -->
        <div class="price-chip">${fmtIDR(p.price)}</div>

        <!-- footer: tombol Detail saja -->
        <div class="product-footer">
          <a href="/produk/${p.slug}.html" class="order-btn">Detail</a>
        </div>
      </div>
    </article>`;
  }

  // ====== State ======
  let DATA = [];
  const grid = document.getElementById('grid');
  const q    = document.getElementById('q');
  const cat  = document.getElementById('catSelect');
  const tag  = document.getElementById('tagSelect');
  const crumb= document.getElementById('crumbCurrent');

  // ====== Fetch data & init ======
  fetch('/data/products.json', {cache:'no-store'})
    .then(r => r.ok ? r.json() : Promise.reject('Gagal memuat data'))
    .then(json => {
      DATA = json;
      initFilters(json);
      restoreFromURL();
      apply(); // render pertama
    })
    .catch(err => {
      console.error(err);
      grid.innerHTML = '<p style="grid-column:1/-1;color:#888">Data produk belum tersedia.</p>';
    });

  // ====== Populate filters dinamis ======
  function initFilters(list){
    // kategori unik
    const cats = Array.from(new Set(list.map(p => p.category))).sort((a,b)=>a.localeCompare(b,'id'));
    cat.innerHTML = `<option value="*">Semua Kategori</option>` + cats.map(c=>`<option value="${c}">${c}</option>`).join('');

    // tag unik
    const tags = Array.from(new Set(list.flatMap(p=>p.tags||[]))).sort((a,b)=>a.localeCompare(b,'id'));
    tag.innerHTML = tags.map(t=>`<option value="${t}">${t}</option>`).join('');
  }

  // ====== URL sync ======
  function restoreFromURL(){
    const params = new URLSearchParams(location.search);
    if(params.get('q')) q.value = params.get('q');
    if(params.get('kategori')) cat.value = params.get('kategori');

    if(params.get('tag')){
      const selected = params.get('tag').split(',').map(decodeURIComponent);
      [...tag.options].forEach(o => { if(selected.includes(o.value)) o.selected = true; });
    }
  }
  function syncURL(kategori, tags, keyword){
    const p = new URLSearchParams();
    if(keyword) p.set('q', keyword);
    if(kategori && kategori!=='*') p.set('kategori', kategori);
    if(tags.length) p.set('tag', tags.join(','));
    history.replaceState(null,'', p.toString()?`?${p.toString()}`:location.pathname);
  }

  // ====== Filter & render ======
  function apply(){
    const keyword = q.value.trim().toLowerCase();
    const kategori= cat.value;
    const tagsSel = [...tag.selectedOptions].map(o=>o.value);

    const tagTrail = tagsSel.length ? ' · '+tagsSel.map(t=>'#'+t).join(', ') : '';
    crumb.textContent = (kategori==='*' || !kategori ? 'Produk' : `Produk › ${kategori}`) + tagTrail;

    const filtered = DATA.filter(p=>{
      const matchQ = !keyword || p.title.toLowerCase().includes(keyword);
      const matchK = !kategori || kategori==='*' || p.category===kategori;
      const matchT = !tagsSel.length || tagsSel.some(t => (p.tags||[]).includes(t));
      return matchQ && matchK && matchT;
    });

    grid.innerHTML = filtered.map(cardHTML).join('') || '<p style="grid-column:1/-1;color:#888">Tidak ada produk yang cocok.</p>';

    syncURL(kategori, tagsSel, keyword);
  }

  q.addEventListener('input', apply);
  cat.addEventListener('change', apply);
  tag.addEventListener('change', apply);

  // ====== Popup menu ======
  (function(){
    const btn=document.getElementById('menuButton'), pop=document.getElementById('popupMenu');
    if(!btn||!pop) return;
    pop.innerHTML=`<ul>
      <li><a href="/kategori/"><span class="iconify" data-icon="mdi:shape-outline"></span>Kategori</a></li>
      <li><a href="/tag/"><span class="iconify" data-icon="mdi:tag-outline"></span>Tag</a></li>
      <li><a href="/kontak.html"><span class="iconify" data-icon="mdi:phone-outline"></span>Kontak</a></li>
    </ul>`;
    btn.addEventListener('click',e=>{e.stopPropagation();pop.classList.toggle('show');btn.setAttribute('aria-expanded',pop.classList.contains('show'))});
    document.addEventListener('click',e=>{if(!pop.contains(e.target)) pop.classList.remove('show')});
  })();
  </script>
</body>
</html>
