<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Katalog Produk | Customin.co</title>
  <meta name="description" content="Katalog produk furniture custom: kursi, meja, lemari, rak, dan lainnya.">
  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>

  <!-- Pakai CSS katalog utama + cart -->
  <link rel="stylesheet" href="/katalog.css" />
  <link rel="stylesheet" href="/assets/cart.css" />

  <!-- Tambahan kecil: pastikan gambar 1:1 & tombol rapi -->
  <style>
    .product-img{ position:relative; display:block; width:100%; aspect-ratio:1/1; background:#f7f7f7; }
    .product-img img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; }
    .product-footer{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .product-price{ color:var(--accent); font-weight:700; font-size:14px; flex:1 1 auto; min-width:0; }
    .order-btn{ display:inline-flex; align-items:center; justify-content:center; height:34px; padding:0 12px; border:1px solid #ddd; border-radius:12px; background:#fff; font-size:12px; font-weight:600; text-decoration:none; box-shadow:0 2px 4px rgba(0,0,0,.05); white-space:nowrap; }
    .order-btn:active{ transform:translateY(1px); }
    .rating-chip{ display:inline-flex; align-items:center; gap:6px; font-size:12px; color:#6b7280; }
    .rating-chip .iconify{ color:#FFD54A; font-size:16px; }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <div class="bio-card">

      <header class="page-head">
        <nav class="crumbs" aria-label="Breadcrumb">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="sep" aria-hidden="true">›</li>
            <li aria-current="page" id="crumbCurrent">Produk</li>
          </ol>
        </nav>
        <h1 class="page-title">Katalog Produk</h1>
      </header>

      <main class="card-content" id="main">
        <!-- Filter -->
        <section class="filters">
          <div class="search-wrap">
            <span class="iconify" data-icon="mdi:magnify"></span>
            <input id="q" type="search" placeholder="Cari produk… (mis. kursi, meja)" autocomplete="off">
          </div>

          <div class="selects">
            <label class="select">
              <span class="select-label">Kategori</span>
              <select id="catSelect">
                <option value="*">Semua Kategori</option>
              </select>
            </label>

            <label class="select">
              <span class="select-label">Tag</span>
              <select id="tagSelect" multiple></select>
            </label>
          </div>

          <p class="hint">Tip: tahan <b>Ctrl/Cmd</b> untuk pilih banyak tag.</p>
        </section>

        <!-- Grid -->
        <section class="produk-grid" id="grid" aria-live="polite"></section>
      </main>

      <!-- NAV -->
      <nav class="in-card-nav" aria-label="Navigasi utama">
        <div class="nav-content">
          <a href="/" class="nav-item" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
          <button type="button" class="menu-button" id="menuButton" aria-controls="popupMenu" aria-expanded="false" aria-label="Menu"><span class="iconify" data-icon="mdi:view-grid-outline"></span></button>
          <a href="/keranjang" class="nav-item js-cart-btn" title="Keranjang" aria-label="Keranjang">
            <span class="iconify" data-icon="mdi:cart-outline"></span>
            <span class="cart-badge" data-cart-count>0</span>
          </a>
        </div>
      </nav>

    </div>
  </div>

  <div class="popup-menu" id="popupMenu"></div>

  <script src="/assets/cart.js" defer></script>

  <script>
    // ===== Util
    const formatRp = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);

    // ===== State
    let DATA = [], CATEGORIES = new Set(), TAGS = new Set();

    // ===== Bootstrap
    (async function init(){
      const res = await fetch('/data/products.json', {cache:'no-store'});
      DATA = await res.json();

      // Kumpulkan kategori & tag dari data
      DATA.forEach(p => {
        if (p.category) CATEGORIES.add(p.category);
        (p.tags||[]).forEach(t => TAGS.add(t));
      });

      // Isi filter
      const catSel = document.getElementById('catSelect');
      [...CATEGORIES].sort().forEach(c=>{
        const o=document.createElement('option'); o.value=c; o.textContent=c; catSel.appendChild(o);
      });
      const tagSel = document.getElementById('tagSelect');
      [...TAGS].sort().forEach(t=>{
        const o=document.createElement('option'); o.value=t; o.textContent=t; tagSel.appendChild(o);
      });

      // Sync dari URL
      const params = new URLSearchParams(location.search);
      if(params.get('q')) document.getElementById('q').value = params.get('q');
      if(params.get('kategori')) catSel.value = params.get('kategori');
      if(params.get('tag')){
        const arr=params.get('tag').split(',').map(decodeURIComponent);
        [...tagSel.options].forEach(o=>{ if(arr.includes(o.value)) o.selected=true; });
      }

      bindFilters();
      render();
    })().catch(console.error);

    // ===== Filter handler
    function bindFilters(){
      const q   = document.getElementById('q');
      const cat = document.getElementById('catSelect');
      const tag = document.getElementById('tagSelect');
      const apply = ()=> render();

      q.addEventListener('input',apply);
      cat.addEventListener('change',apply);
      tag.addEventListener('change',apply);
    }

    // ===== Render grid
    function render(){
      const grid = document.getElementById('grid');
      const qVal   = document.getElementById('q').value.trim().toLowerCase();
      const catVal = document.getElementById('catSelect').value;
      const tags   = [...document.getElementById('tagSelect').selectedOptions].map(o=>o.value);

      // Breadcrumb text + sync URL
      const crumb = document.getElementById('crumbCurrent');
      const tagTrail = tags.length ? ' · ' + tags.map(t=>'#'+t).join(', ') : '';
      crumb.textContent = (catVal==='*' ? 'Produk' : `Produk › ${catVal}`) + tagTrail;

      const p = new URLSearchParams();
      if(qVal) p.set('q', qVal);
      if(catVal && catVal!=='*') p.set('kategori',catVal);
      if(tags.length) p.set('tag', tags.join(','));
      history.replaceState(null,'', p.toString()?`?${p}`:location.pathname);

      const list = DATA.filter(item=>{
        const mQ = !qVal || item.title.toLowerCase().includes(qVal) || (item.excerpt||'').toLowerCase().includes(qVal);
        const mC = catVal==='*' || item.category===catVal;
        const mT = tags.length===0 || tags.some(t => (item.tags||[]).includes(t));
        return mQ && mC && mT;
      });

      grid.innerHTML = list.map(cardHTML).join('') || `<p style="color:#6b7280;margin:8px 2px 16px">Tidak ada produk yang cocok.</p>`;
    }

    function cardHTML(p){
      const price = formatRp(p.price);
      const badge = p.badge ? `<span class="badge ${p.badge==='Promo'?'badge-sale':''}">${p.badge}</span>` : '';
      const rating = (p.rating?`
        <span class="rating-chip"><span class="iconify" data-icon="mdi:star"></span>${p.rating.toFixed(1)} <span style="opacity:.7">(${p.reviewsCount||0})</span></span>
      `:'');
      return `
      <article class="product-card" data-kategori="${p.category}" data-tags="${(p.tags||[]).join(',')}">
        <a class="product-img" href="/produk/${p.slug}.html" aria-label="${p.title}">
          <img src="${p.cover}" alt="${p.title}">
          ${badge}
        </a>
        <div class="product-content">
          <h2 class="product-title"><a href="/produk/${p.slug}.html">${p.title}</a></h2>
          ${rating}
          <div class="product-footer">
            <div class="product-price">${price}</div>
            <a href="/produk/${p.slug}.html" class="order-btn">Detail</a>
          </div>
        </div>
      </article>`;
    }
  </script>

  <!-- Popup menu mini (opsional, sama seperti halaman lain) -->
  <script>
    (function(){
      const btn=document.getElementById('menuButton'), pop=document.getElementById('popupMenu');
      if(!btn||!pop) return;
      pop.innerHTML=`<ul>
        <li><a href="/kategori/"><span class="iconify" data-icon="mdi:shape-outline"></span>Kategori</a></li>
        <li><a href="/tag/"><span class="iconify" data-icon="mdi:tag-outline"></span>Tag</a></li>
        <li><a href="/kontak.html"><span class="iconify" data-icon="mdi:phone-outline"></span>Kontak</a></li>
      </ul>`;
      btn.addEventListener('click',e=>{e.stopPropagation();pop.classList.toggle('show');btn.setAttribute('aria-expanded',pop.classList.contains('show'))});
      document.addEventListener('click',e=>{if(!pop.contains(e.target)) pop.classList.remove('show')});
    })();
  </script>
</body>
</html>
