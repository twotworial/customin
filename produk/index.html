<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Katalog Produk | Customin.co</title>
  <meta name="description" content="Katalog produk furniture custom: kursi, meja, lemari, rak, dan lainnya.">
  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>

  <!-- Styles -->
  <link rel="stylesheet" href="/produk/produk.css" />
  <link rel="stylesheet" href="/assets/cart.css" />
</head>
<body>
  <div class="main-wrapper">
    <div class="bio-card">

      <header class="page-head">
        <nav class="crumbs" aria-label="Breadcrumb">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="sep" aria-hidden="true">â€º</li>
            <li aria-current="page" id="crumbCurrent">Produk</li>
          </ol>
        </nav>
        <h1 class="page-title">Katalog Produk</h1>
      </header>

      <main class="card-content" id="main">
        <!-- Filter -->
        <section class="filters">
          <div class="search-wrap">
            <span class="iconify" data-icon="mdi:magnify"></span>
            <input id="q" type="search" placeholder="Cari produkâ€¦ (mis. kursi, meja)" autocomplete="off">
          </div>

          <div class="selects">
            <label class="select">
              <span class="select-label">Kategori</span>
              <select id="catSelect">
                <option value="*">Semua Kategori</option>
              </select>
            </label>

            <label class="select">
              <span class="select-label">Tag</span>
              <select id="tagSelect" multiple></select>
            </label>
          </div>

          <p class="hint">Tip: tahan <b>Ctrl/Cmd</b> untuk pilih banyak tag.</p>
        </section>

        <!-- Grid -->
        <section class="produk-grid" id="grid" aria-live="polite"></section>

        <div class="empty-note" id="emptyNote" hidden>
          <div class="empty-emoji">ðŸª‘</div>
          <div class="empty-title">Tidak ada produk yang cocok</div>
          <p class="empty-text">Coba ubah kata kunci, kategori, atau tag.</p>
        </div>
      </main>

      <!-- NAV -->
      <nav class="in-card-nav" aria-label="Navigasi utama">
        <div class="nav-content">
          <a href="/" class="nav-item" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
          <button type="button" class="menu-button" id="menuButton" aria-controls="popupMenu" aria-expanded="false" aria-label="Menu"><span class="iconify" data-icon="mdi:view-grid-outline"></span></button>
          <a href="/keranjang" class="nav-item js-cart-btn" title="Keranjang" aria-label="Keranjang">
            <span class="iconify" data-icon="mdi:cart-outline"></span>
            <span class="cart-badge" data-cart-count>0</span>
          </a>
        </div>
      </nav>

    </div>
  </div>

  <div class="popup-menu" id="popupMenu"></div>

  <!-- Cart -->
  <script src="/assets/cart.js" defer></script>

  <script>
  // Katalog sederhana berbasis /data/products.json
  // Struktur item minimal: { "slug":"kursi-lipat-jati", "title":"Kursi Lipat Jati", "price":183000, "category":"Kursi", "tags":["Minimalis","Jati Solid"], "cover":"/produk/foto/kursi-lipat.webp" }
  (async function(){
    const qEl   = document.getElementById('q');
    const catEl = document.getElementById('catSelect');
    const tagEl = document.getElementById('tagSelect');
    const grid  = document.getElementById('grid');
    const empty = document.getElementById('emptyNote');

    let items = [];
    try {
      const res = await fetch('/data/products.json', {cache:'no-store'});
      items = await res.json();
    } catch(e){ console.error('Gagal memuat products.json', e); items = []; }

    // unik kategori & tag
    const cats = Array.from(new Set(items.map(i=>i.category).filter(Boolean))).sort();
    cats.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; catEl.appendChild(o); });
    const tags = Array.from(new Set(items.flatMap(i=>Array.isArray(i.tags)?i.tags:[]))).sort();
    tags.forEach(t=>{ const o=document.createElement('option'); o.value=t; o.textContent=t; tagEl.appendChild(o); });

    // sync dari URL
    const params = new URLSearchParams(location.search);
    if(params.get('q')) qEl.value = params.get('q');
    if(params.get('kategori')) catEl.value = params.get('kategori');
    if(params.get('tag')){
      const arr=params.get('tag').split(',').map(decodeURIComponent);
      [...tagEl.options].forEach(o=>{ if(arr.includes(o.value)) o.selected=true; });
    }

    const fmt = (n)=> new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n||0);

    function cardHTML(p){
      const href = `/produk/produk.html?slug=${encodeURIComponent(p.slug)}`;
      const price = typeof p.price==='number' ? fmt(p.price) : p.price || 'Rp -';
      const cover = p.cover || (Array.isArray(p.images)&&p.images[0]) || 'https://via.placeholder.com/600x600?text=Foto';
      return `
      <article class="product-card" data-kategori="${(p.category||'')}" data-tags="${(p.tags||[]).join(',')}">
        <a class="product-img" href="${href}">
          <img src="${cover}" alt="${p.title||'Produk'}">
          ${p.badge?`<span class="badge">${p.badge}</span>`:''}
        </a>
        <div class="product-content">
          <h2 class="product-title"><a href="${href}">${p.title||'Produk'}</a></h2>
          <div class="product-footer">
            <div class="product-price">${price}</div>
            <a href="${href}" class="order-btn">Detail</a>
          </div>
        </div>
      </article>`;
    }

    function syncURL(kategori,tags,keyword){
      const p=new URLSearchParams();
      if(keyword) p.set('q',keyword);
      if(kategori && kategori!=='*') p.set('kategori',kategori);
      if(tags.length) p.set('tag',tags.join(','));
      history.replaceState(null,'', p.toString()?`?${p.toString()}`:location.pathname);
    }

    function apply(){
      const keyword = qEl.value.trim().toLowerCase();
      const kategori = catEl.value;
      const selTags = [...tagEl.selectedOptions].map(o=>o.value);

      const filtered = items.filter(p=>{
        const matchQ = !keyword || (p.title||'').toLowerCase().includes(keyword);
        const matchK = kategori==='*' || (p.category===kategori);
        const pTags = Array.isArray(p.tags)?p.tags:[];
        const matchT = selTags.length===0 || selTags.some(x=>pTags.includes(x));
        return matchQ && matchK && matchT;
      });

      grid.innerHTML = filtered.map(cardHTML).join('');
      empty.hidden = filtered.length>0;

      const trail = selTags.length ? ' Â· '+selTags.map(t=>'#'+t).join(', ') : '';
      document.getElementById('crumbCurrent').textContent = (kategori==='*'?'Produk':`Produk â€º ${kategori}`)+trail;

      syncURL(kategori, selTags, keyword);
    }

    qEl.addEventListener('input', apply);
    catEl.addEventListener('change', apply);
    tagEl.addEventListener('change', apply);

    // render awal
    grid.innerHTML = items.map(cardHTML).join('');
    empty.hidden = items.length>0;
    apply();
  })();

  // Popup menu
  (function(){
    const btn=document.getElementById('menuButton'), pop=document.getElementById('popupMenu');
    if(!btn||!pop) return;
    pop.innerHTML=`<ul>
      <li><a href="/kategori/"><span class="iconify" data-icon="mdi:shape-outline"></span>Kategori</a></li>
      <li><a href="/tag/"><span class="iconify" data-icon="mdi:tag-outline"></span>Tag</a></li>
      <li><a href="/kontak.html"><span class="iconify" data-icon="mdi:phone-outline"></span>Kontak</a></li>
    </ul>`;
    btn.addEventListener('click',e=>{e.stopPropagation();pop.classList.toggle('show');btn.setAttribute('aria-expanded',pop.classList.contains('show'))});
    document.addEventListener('click',e=>{if(!pop.contains(e.target)) pop.classList.remove('show')});
  })();
  </script>
</body>
</html>
