<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Blog & Artikel | Customin.co</title>
  <meta name="description" content="Artikel seputar furniture custom, tips perawatan, dan behind-the-scenes produksi dari Customin.co.">

  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800;900&display=swap" rel="stylesheet">

  <!-- CSP (tambahan untuk Disqus count) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' https: data:;
                 script-src 'self' https://code.iconify.design https://cloud.umami.is https://*.disqus.com 'unsafe-inline';
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src 'self' https://fonts.gstatic.com;
                 connect-src 'self';
                 frame-src https://disqus.com https://*.disqus.com;
                 base-uri 'self';
                 form-action 'self';
                 upgrade-insecure-requests">

  <link rel="stylesheet" href="/assets/cart.css">
  <link rel="stylesheet" href="/blog/blog.css">

  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>

  <!-- Umami -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="60976a45-9ae8-40bf-a8bc-99c152ba5288"></script>
</head>
<body>
  <div class="main-wrapper">
    <div class="bio-card">
      <header class="page-head">
        <nav class="crumbs" aria-label="Breadcrumb">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="sep" aria-hidden="true">›</li>
            <li aria-current="page">Blog</li>
          </ol>
        </nav>
        <h1 class="page-title">Blog & Artikel</h1>
      </header>

      <main class="card-content">
        <!-- Search optional -->
        <section class="filters">
          <div class="search-wrap">
            <span class="iconify" data-icon="mdi:magnify"></span>
            <input id="q" type="search" placeholder="Cari artikel… (mis. jati, perawatan)" autocomplete="off" />
          </div>
        </section>

        <!-- List 1 kolom, cover 2:1 -->
        <section id="postsList" class="posts-list" aria-live="polite"></section>

        <!-- Fallback kosong -->
        <template id="postCardTmpl">
          <article class="post-card">
            <a class="post-cover" href="#">
              <img src="" alt="">
            </a>
            <div class="post-content">
              <h2 class="post-title"><a href="#"></a></h2>
              <div class="post-meta">
                <time class="post-date"></time>
                <span class="dot"></span>
                <a class="post-comments" href="#" data-disqus-identifier="">Komentar</a>
                <span class="dot"></span>
                <a class="pd-chip" href="#"><span class="iconify" data-icon="mdi:label-outline"></span><span class="chip-text"></span></a>
              </div>
              <p class="post-excerpt"></p>
            </div>
          </article>
        </template>
      </main>

      <!-- NAV (Home | Menu | Cart) -->
      <nav class="in-card-nav" aria-label="Navigasi utama">
        <div class="nav-content">
          <a href="/" class="nav-item" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
          <button type="button" class="menu-button" id="menuButton" aria-controls="popupMenu" aria-expanded="false" aria-label="Menu"><span class="iconify" data-icon="mdi:view-grid-outline"></span></button>
          <a href="/keranjang" class="nav-item js-cart-btn" title="Keranjang" aria-label="Keranjang">
            <span class="iconify" data-icon="mdi:cart-outline"></span>
            <span class="cart-badge" data-cart-count>0</span>
          </a>
        </div>
      </nav>
    </div>
  </div>

  <div class="popup-menu" id="popupMenu"></div>

  <!-- Cart + menu -->
  <script src="/assets/cart.js" defer></script>
  <script>
    // Menu popup (singkat)
    (()=>{const b=document.getElementById('menuButton'),p=document.getElementById('popupMenu');
      if(!b||!p) return;
      p.innerHTML=`<ul>
        <li><a href="/produk/"><span class="iconify" data-icon="mdi:view-grid-plus-outline"></span>Produk</a></li>
        <li><a href="/kategori/"><span class="iconify" data-icon="mdi:shape-outline"></span>Kategori</a></li>
        <li><a href="/tag/"><span class="iconify" data-icon="mdi:tag-outline"></span>Tag</a></li>
        <li><a href="/kontak.html"><span class="iconify" data-icon="mdi:phone-outline"></span>Kontak</a></li>
      </ul>`;
      b.addEventListener('click',e=>{e.stopPropagation();p.classList.toggle('show');b.setAttribute('aria-expanded',p.classList.contains('show'));});
      document.addEventListener('click',e=>{if(!p.contains(e.target)) p.classList.remove('show')});
    })();

    // Render posts dari /blog/posts.json
    (async ()=>{
      const list = document.getElementById('postsList');
      const tmpl = document.getElementById('postCardTmpl');
      const q = document.getElementById('q');

      let posts = [];
      try {
        const res = await fetch('/blog/posts.json', {cache:'no-store'});
        posts = await res.json();
      } catch(e){ console.error('Gagal load posts.json', e); }

      const render = ()=>{
        const keyword = (q.value||'').toLowerCase().trim();
        list.innerHTML = '';
        posts
          .filter(p => !keyword || (p.title+p.excerpt+p.category).toLowerCase().includes(keyword))
          .sort((a,b)=> new Date(b.date)-new Date(a.date))
          .forEach(p=>{
            const card = tmpl.content.cloneNode(true);
            const url  = p.url || `/blog/${p.slug}.html`;
            card.querySelector('.post-cover').href = url;
            const img = card.querySelector('.post-cover img');
            img.src = p.cover || '/OG/Cover-Furniture-Custom-by-Customin.webp';
            img.alt = p.coverAlt || p.title;

            card.querySelector('.post-title a').textContent = p.title;
            card.querySelector('.post-title a').href = url;
            card.querySelector('.post-date').textContent = new Date(p.date).toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'});
            const cmt = card.querySelector('.post-comments');
            cmt.href = `${url}#disqus_thread`;
            cmt.setAttribute('data-disqus-identifier', p.id || p.slug);

            const chip = card.querySelector('.pd-chip');
            chip.href = `/blog/?q=${encodeURIComponent(p.category)}`;
            chip.querySelector('.chip-text').textContent = p.category||'Umum';

            card.querySelector('.post-excerpt').textContent = p.excerpt||'';
            list.appendChild(card);
          });
      };

      q?.addEventListener('input', render);
      render();

      // Disqus count
      const s = document.createElement('script');
      s.id = 'dsq-count-scr';
      s.src = '//custominco.disqus.com/count.js';
      s.async = true;
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
