<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Blog & Artikel | Customin.co</title>
  <meta name="description" content="Artikel seputar furniture custom, tips perawatan, dan behind-the-scenes produksi dari Customin.co.">

  <link rel="icon" href="/OG/favicon-customin-furniture-custom.ico" />

  <!-- CSP: Iconify via CDN, Inter lokal -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://code.iconify.design https://cloud.umami.is https://*.disqus.com;
    connect-src 'self' https://api.iconify.design https://api.simplesvg.com https://api.unisvg.com https://cloud.umami.is https://api-gateway.umami.dev https://*.umami.is https://*.umami.dev;
    style-src 'self' 'unsafe-inline';
    font-src 'self' data:;
    img-src 'self' https: data:;
    frame-src https://disqus.com https://*.disqus.com;
    base-uri 'self';
    form-action 'self';
    upgrade-insecure-requests
  ">

  <!-- Preload font lokal -->
  <link rel="preload" href="/assets/fonts/InterVariable.woff2" as="font" type="font/woff2" crossorigin>

  <!-- Inter Variable lokal (match index.html) + util sr-only -->
  <style>
    :root{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    @supports (font-variation-settings: normal){
      :root{font-family:"InterVariable",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-optical-sizing:auto}
    }
    @font-face{
      font-family:InterVariable; font-style:normal; font-weight:100 900; font-display:swap;
      src:url("/assets/fonts/InterVariable.woff2") format("woff2");
    }
    .sr-only{position:absolute!important;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
  </style>

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/cart.css">
  <link rel="stylesheet" href="/blog/blog.css">

  <!-- Iconify (online) -->
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js" defer></script>

  <!-- Umami -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="60976a45-9ae8-40bf-a8bc-99c152ba5288"></script>
</head>
<body>
  <div class="main-wrapper">
    <div class="bio-card">
      <header class="page-head">
        <nav class="crumbs" aria-label="Breadcrumb">
          <ol>
            <li><a href="/">Home</a></li>
            <li class="sep" aria-hidden="true">›</li>
            <li aria-current="page">Blog</li>
          </ol>
        </nav>
        <h1 class="page-title">Blog & Artikel</h1>
      </header>

      <main class="card-content">
        <!-- Search -->
        <section class="filters">
          <div class="search-wrap">
            <span class="iconify" data-icon="mdi:magnify"></span>
            <input id="q" type="search" placeholder="Cari artikel… (mis. jati, perawatan)" autocomplete="off" />
          </div>
        </section>

        <!-- Daftar artikel -->
        <section id="postsList" class="posts-list" aria-live="polite"></section>

        <!-- Pagination -->
        <nav id="pager" class="pager" aria-label="Navigasi halaman"></nav>

        <!-- Template kartu artikel -->
        <template id="postCardTmpl">
          <article class="post-card">
            <a class="post-cover" href="#">
              <img src="" alt="">
            </a>
            <div class="post-content">
              <h2 class="post-title"><a href="#"></a></h2>
              <div class="post-meta">
                <time class="post-date"></time>
                <span class="dot"></span>

                <!-- Ikon komentar (tanpa border/bg) + angka merah -->
                <span class="cmt-wrap">
                  <a class="post-comments-icon" href="#" aria-label="Komentar">
                    <span class="iconify" data-icon="mdi:message-text-outline"></span>
                  </a>
                  <span class="cmt-count" aria-hidden="true"></span>
                </span>

                <!-- Anchor tersembunyi utk Disqus count -->
                <a class="post-comments sr-only" href="#" data-disqus-identifier="">Komentar</a>

                <span class="dot"></span>
                <a class="pd-chip" href="#">
                  <span class="iconify" data-icon="mdi:label-outline"></span>
                  <span class="chip-text"></span>
                </a>
              </div>
              <p class="post-excerpt"></p>
            </div>
          </article>
        </template>
      </main>

      <!-- NAV (Home | Menu | Cart) -->
      <nav class="in-card-nav" aria-label="Navigasi utama">
        <div class="nav-content">
          <a href="/" class="nav-item" title="Home" aria-label="Home"><span class="iconify" data-icon="mdi:home-outline"></span></a>
          <button type="button" class="menu-button" id="menuButton" aria-controls="popupMenu" aria-expanded="false" aria-label="Menu"><span class="iconify" data-icon="mdi:view-grid-outline"></span></button>
          <a href="/keranjang" class="nav-item js-cart-btn" title="Keranjang" aria-label="Keranjang">
            <span class="iconify" data-icon="mdi:cart-outline"></span>
            <span class="cart-badge" data-cart-count>0</span>
          </a>
        </div>
      </nav>
    </div>
  </div>

  <div class="popup-menu" id="popupMenu"></div>

  <!-- Cart + menu -->
  <script src="/assets/cart.js" defer></script>
  <script>
    // Menu popup singkat
    (()=>{const b=document.getElementById('menuButton'),p=document.getElementById('popupMenu');
      if(!b||!p) return;
      p.innerHTML=`<ul>
        <li><a href="/produk/"><span class="iconify" data-icon="mdi:view-grid-plus-outline"></span>Produk</a></li>
        <li><a href="/kategori/"><span class="iconify" data-icon="mdi:shape-outline"></span>Kategori</a></li>
        <li><a href="/tag/"><span class="iconify" data-icon="mdi:tag-outline"></span>Tag</a></li>
        <li><a href="/kontak.html"><span class="iconify" data-icon="mdi:phone-outline"></span>Kontak</a></li>
      </ul>`;
      b.addEventListener('click',e=>{e.stopPropagation();p.classList.toggle('show');b.setAttribute('aria-expanded',p.classList.contains('show'));});
      document.addEventListener('click',e=>{if(!p.contains(e.target)) p.classList.remove('show')});
    })();

    // List + Pagination
    (async ()=>{
      const PER_PAGE = 9;

      const list   = document.getElementById('postsList');
      const pager  = document.getElementById('pager');
      const tmpl   = document.getElementById('postCardTmpl');
      const qInput = document.getElementById('q');

      // baca q & page dari URL
      const params = new URLSearchParams(location.search);
      let keyword = (params.get('q') || '').trim();
      let current = Math.max(1, parseInt(params.get('page') || '1', 10) || 1);
      if(qInput) qInput.value = keyword;

      // helper update URL (tanpa reload)
      function setQuery(q, page){
        const sp = new URLSearchParams(location.search);
        q ? sp.set('q', q) : sp.delete('q');
        page > 1 ? sp.set('page', page) : sp.delete('page');
        history.replaceState(null, '', sp.toString() ? ('?'+sp.toString()) : location.pathname);
      }

      let posts = [];
      try{
        const res = await fetch('/blog/posts.json', {cache:'no-store'});
        posts = await res.json();
      }catch(e){ console.error('Gagal load posts.json', e); }

      function buildCard(p){
        const card = tmpl.content.cloneNode(true);
        const url  = p.url || `/blog/${p.slug}.html`;
        const id   = p.id || p.slug || p.title;

        // cover
        card.querySelector('.post-cover').href = url;
        const img = card.querySelector('.post-cover img');
        img.src = p.cover || '/OG/Cover-Furniture-Custom-by-Customin.webp';
        img.alt = p.coverAlt || p.title || 'Cover artikel';

        // judul
        const t = card.querySelector('.post-title a');
        t.textContent = p.title || '(Tanpa judul)';
        t.href = url;

        // tanggal
        const d = card.querySelector('.post-date');
        d.textContent = p.date ? new Date(p.date).toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'}) : '';

        // komentar ikon + anchor Disqus (hidden)
        const icon = card.querySelector('.post-comments-icon');
        const cmtA = card.querySelector('.post-comments');
        const cnt  = card.querySelector('.cmt-count');
        const href = `${url}#disqus_thread`;
        icon.href = href;
        cmtA.href = href;
        cmtA.setAttribute('data-disqus-identifier', id);

        // sync angka dari anchor Disqus
        const sync = ()=>{
          const m = (cmtA.textContent || '').match(/\d+/);
          const n = m ? parseInt(m[0],10) : 0;
          cnt.textContent = n>0 ? (n>999?'999+':String(n)) : '';
          icon.setAttribute('aria-label', cnt.textContent ? `Komentar (${cnt.textContent})` : 'Komentar');
        };
        new MutationObserver(sync).observe(cmtA, {childList:true,subtree:true,characterData:true});
        setTimeout(sync, 600);

        // kategori
        const chip = card.querySelector('.pd-chip');
        const cat  = p.category || 'Umum';
        chip.href = `/blog/?q=${encodeURIComponent(cat)}`;
        chip.querySelector('.chip-text').textContent = cat;

        // excerpt
        card.querySelector('.post-excerpt').textContent = p.excerpt || '';

        return card;
      }

      function render(){
        // filter + sort
        const filtered = posts
          .filter(p => !keyword || (p.title+p.excerpt+p.category).toLowerCase().includes(keyword.toLowerCase()))
          .sort((a,b)=> new Date(b.date)-new Date(a.date));

        const totalPages = Math.max(1, Math.ceil(filtered.length / PER_PAGE));
        current = Math.min(Math.max(1, current), totalPages);

        // slice halaman
        const start = (current-1)*PER_PAGE;
        const pageItems = filtered.slice(start, start+PER_PAGE);

        // render list
        list.innerHTML = '';
        pageItems.forEach(p => list.appendChild(buildCard(p)));

        // render pager
        renderPager(totalPages);
        setQuery(keyword, current);

        // load Disqus count sekali
        if(!document.getElementById('dsq-count-scr')){
          const s = document.createElement('script');
          s.id = 'dsq-count-scr';
          s.src = '//custominco.disqus.com/count.js';
          s.async = true;
          document.body.appendChild(s);
        }else{
          // trigger ulang count
          if(window.DISQUSWIDGETS && typeof DISQUSWIDGETS.getCount === 'function'){
            window.DISQUSWIDGETS.getCount({reset:true});
          }
        }
      }

      function renderPager(total){
        pager.innerHTML = '';
        if(total <= 1){ return; }

        const btn = (label, page, opts={})=>{
          const el = document.createElement('button');
          el.type = 'button';
          el.className = 'pg-btn';
          el.innerHTML = label;
          if(opts.disabled){ el.disabled = true; }
          if(opts.current){ el.setAttribute('aria-current','page'); }
          el.addEventListener('click', ()=>{ current = page; render(); window.scrollTo({top:0, behavior:'smooth'}); });
          return el;
        };

        // Prev
        pager.appendChild(btn('<span class="iconify" data-icon="mdi:chevron-left"></span>', Math.max(1,current-1), {disabled: current===1}));

        // numbers (windowed)
        const makeNum = p => pager.appendChild(btn(String(p), p, {current: p===current}));
        const addEll  = () => { const s=document.createElement('span'); s.className='pg-ellipsis'; s.textContent='…'; pager.appendChild(s); };

        const windowSize = 2;
        let start = Math.max(1, current-windowSize);
        let end   = Math.min(total, current+windowSize);

        if(start > 1){ makeNum(1); if(start>2) addEll(); }
        for(let p=start; p<=end; p++) makeNum(p);
        if(end < total){ if(end<total-1) addEll(); makeNum(total); }

        // Next
        pager.appendChild(btn('<span class="iconify" data-icon="mdi:chevron-right"></span>', Math.min(total,current+1), {disabled: current===total}));
      }

      // events
      qInput?.addEventListener('input', ()=>{
        keyword = (qInput.value||'').trim();
        current = 1;
        render();
      });

      // first paint
      render();
    })();
  </script>
</body>
</html>
